<!DOCTYPE HTML>
<html lang="en">

<head>
    <!-- Force latest IE rendering engine or ChromeFrame if installed -->
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><![endif]-->
    <meta charset="utf-8">
    <title>ofx::HTTP::BasicIPVideoServer</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- Bootstrap styles -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Generic page styles -->
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">ofx::HTTP::BasicIPVideoServer Demo</a>
            </div>
        </div>
    </div>
    <div class="container">
        <h1>Basic IPVideo Server Demo</h1>
        <br>
        <blockquote>
            <p>
                <code>ofx::HTTP::BasicIPVideoServer</code> is a simple server for MJPEG-based IPVideo.
            </p>

        </blockquote>

        <p>
            <!-- the video image -->
            <!-- <img src="/ipvideo" /> -->
        </p>

        <br>
    </div>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
        // window.setInterval(() => {
        fetch('/ipvideo')
            .then((response) => {
                console.log(response)

                const reader = response.body.getReader();
                const stream = new ReadableStream({
                    start(controller) {
                        // The following function handles each data chunk
                        function push() {
                            // "done" is a Boolean and value a "Uint8Array"
                            reader.read().then(({ done, value }) => {
                                // console.log(value)
                                // Is there no more data to read?
                                if (done) {
                                    // Tell the browser that we have finished sending data
                                    controller.close();
                                    return;
                                }

                                // Get the data and send it to the browser via the controller
                                controller.enqueue(value);
                                push();
                            });
                        };

                        push();
                    }
                })
            })
            .catch(console.log)
        // }, 1000);
    </script>
</body>

</html>